<link rel="stylesheet" href="vendor/layui/css/layui.css">
<script type="text/javascript" src="vendor/layui/layui.js"></script>
<link rel="stylesheet" href="vendor/layui/css/stu-index.css">
<script type="text/javascript" src="vendor/jquery/jquery.js"></script>
<script type="text/javascript" src="vendor/jquery/jquery.cookie.js"></script>
<body style="background: transparent url(img/PTS_Movie_Branding_Background.jpg)no-repeat 0 0;background-attachment: fixed;background-size: cover;">
<div class="layui-layout layui-layout-admin">
	<div class="layui-header" style="z-index:9999;position: relative;">

		<!-- 头部区域 -->
		<ul class="layui-nav" style="padding: 0 200px;">
			<div class="layui-logo" style="color:white;">AMS-stu</div>
			<li class="layui-nav-item">
				<a href="stu-index">首页</a>
			</li>
			<li class="layui-nav-item">
				<a href="#">社团</a>
				<dl class="layui-nav-child">
				    <dd>
						<a href="club-list">社团展示</a>
					</dd>
					<dd>
						<a href="club-build" id="nav-buildclub">创建社团</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item">
				<a href="#">活动</a>
				<dl class="layui-nav-child">
					<dd>
						<a href="activity-all-list">校内活动</a>
					</dd>
					<dd>
						<a href="activity-inner-list">社内活动</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item">
				<a href="news-all-list">新闻</a>
			</li>
			<li class="layui-nav-item">
				<a href="javascript:;">我的</a>
				<dl class="layui-nav-child">
					<dd>
						<a href="club-mine">我的社团</a>
					</dd>
					<dd>
						<a href="notice-mine">我的公告</a>
					</dd>
					<dd>
						<a href="myAct">我的活动</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item" id="nav-manager">
				<a href="javascript:;">管理</a>
				<dl class="layui-nav-child">
					<dd>
						<a href="manageClub">社团管理</a>
					</dd>
					<dd>
						<a href="manageNotice">公告管理</a>
					</dd>
					<dd>
						<a href="addNotice">发布公告</a>
					</dd>
					<dd>
						<a href="manageAct">活动管理</a>
					</dd>
					<dd>
						<a href="applyAct">申请活动</a>
					</dd>
		            <dd>
						<a href="managenews">新闻管理</a>
					</dd>
					<dd>
						<a href="addnews">发布新闻</a>
					</dd>
				</dl>
			 </li>
		</ul>

		<ul class="layui-nav layui-layout-right">
			<li class="layui-nav-item layui-hide-xs" lay-unselect>
				<input type="text" placeholder="搜索..." autocomplete="off" class="layui-input layui-input-search" layadmin-event="serach" lay-action="template/search/keywords=">
			</li>
			<li class="layui-nav-item">
				<a href="javascript:;" id='username'>
					<img id="userlogo" class="layui-nav-img">
				</a>
				<dl class="layui-nav-child">
					<dd>
						<a href="userinformation">基本资料</a>
					</dd>
					<dd>
						<a href="setPwd">修改密码</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item">
				<a href="javascript:void(0);" onclick="loginout()">退出登录</a>
			</li>
		</ul>

	</div>

<!-- 主体内容 -->
	<div class="layui-body">
		<div style="margin-right:200px;background-color:white;padding:10px 20px 10px 20px;">

			<div class="layui-carousel" id="test" lay-filter="test" style="margin-top: 30px;">
				<div carousel-item="" style="border-radius:25px;">
					<div><img src="img/club/circle1.png"></div>
					<div><img src="img/club/circle2.png"></div>
					<div><img src="img/club/circle3.png"></div>

				</div>
			</div>

			<fieldset class="layui-elem-field" style="margin-top: 30px;border-radius:25px;padding:0 20px 0 20px;border-width:2px;">
				<legend style="font-size:22px;font-weight:500;color:#666666;">社团人数 Top3</legend>

				<div style="text-align:center;">
					<div class="layui-col-md4" style="padding:0 10px 10px 10px;">
						<div class="layui-card" style="margin-bottom: 20px;background-color:#F5F5F5;border-radius:25px;">
						    <div  class="top-cid" style="display:none;"></div>
							<div class="layui-card-header" id="top1-cname" style="font-size: 18px;margin-top:20px;background-color:#A27E7E;color:white;border-top-left-radius:25px;border-top-right-radius:25px;">
							</div>
							<div class="layui-card-body">
								<img id="top1-logo"></img>
								<div id="top1-contents">
								</div>
							</div>
							<div class="site-demo-button" id="layerDemo">
								<button id="joinNow1" class="layui-btn layui-btn-sm layui-btn-normal layui-btn-radius layui-btn-fluid" style="margin-bottom:10px;width:100px;background-color:#A27E7E;">加 入 我 们</button>
							</div>
						</div>
					</div>
					<div class="layui-col-md4" style="padding:0 10px 10px 10px;">
						<div class="layui-card" style="background-color:#F5F5F5;border-radius:25px;">
						    <div  class="top-cid" style="display:none;"></div>
							<div class="layui-card-header" id="top2-cname" style="font-size: 18px;margin-top:20px;background-color:#96A48B;color:white;border-top-left-radius:25px;border-top-right-radius:25px;">
							</div>
							<div class="layui-card-body">
								<img id="top2-logo"></img>
								<div id="top2-contents">
								</div>
							</div>
							<div class="site-demo-button" id="layerDemo">
								<button id="joinNow2" class="layui-btn layui-btn-sm layui-btn-normal layui-btn-radius layui-btn-fluid" style="margin-bottom:10px;width:100px;background-color:#96A48B;">加 入 我 们</button>
							</div>
						</div>
					</div>
					<div class="layui-col-md4" style="padding:0 10px 10px 10px;">
						<div class="layui-card" style="background-color:#F5F5F5;border-radius:25px;">
						    <div  class="top-cid" style="display:none;"></div>
							<div class="layui-card-header" id="top3-cname" style="font-size: 18px;margin-top:20px;background-color:#8696A7;color:white;border-top-left-radius:25px;border-top-right-radius:25px;">
							</div>
							<div class="layui-card-body">
								<img id="top3-logo"></img>
								<div id="top3-contents">
								</div>
							</div>
							<div class="site-demo-button" id="layerDemo">
								<button id="joinNow3" class="layui-btn layui-btn-sm layui-btn-normal layui-btn-radius layui-btn-fluid" style="margin-bottom:10px;width:100px;background-color:#8696A7;">加 入 我 们</button>
							</div>
						</div>
					</div>
				</div>

			</fieldset>

			<fieldset class="layui-elem-field" style="margin-top: 30px;border-radius:25px;padding:0 20px 0 20px;border-width:2px;">
				<legend style="font-size:22px;font-weight:500;color:#666666;">社团一览</legend>
				
				<div class="layui-row" id="btns-type" style="margin:20px 0 0 0;text-align:center;">		
                    <label><input type="radio" name="test" value='0' checked="checked"/><span>全部</span></label>
                </div>

				<div class="layui-fluid">
					<div class="layui-row" id="club-list" style="text-align:center;margin-top:20px;">
					</div>

					<div id="demo" style="text-align: center;margin-top: 10px;"></div>
				</div>

			</fieldset>
		</div>
	</div>

</div>
</body>
<style type="text/css">
            input[type="radio"] {
                display: none;
            }
            input[type="radio"]+span {
                display: inline-block;
                padding-left:20px;
                padding-right:20px;
                height: 35px;
                font-size: 14px;
                line-height:35px;
                text-align: center;
                border: 1px solid #d2d2d2;
                border-radius:50px;
                background-color: white;
                margin-right:12px;
             }
            input[type="radio"]:checked+span {
                border: 2px solid #white;
                background-color: #939391;
                color:white;
            }
</style>
<script>   

   $(function () {

        var str = window.location.href;
        str = str.substring(str.lastIndexOf("/") + 1);
        if ($.cookie(str)) {
            $("html,body").animate({ scrollTop: $.cookie(str) }, 1000);
        }else {
        }
    })
    
    $(window).scroll(function () {
        var str = window.location.href;
        str = str.substring(str.lastIndexOf("/") + 1);
        var top = $(document).scrollTop();
        $.cookie(str, top, { path: '/' });
        return $.cookie(str);
    })

</script>

<script>
	layui.use(['laypage', 'layer', 'element', 'carousel', 'form', 'util'], function() {
		var laypage = layui.laypage,
			layer = layui.layer,
			element = layui.element,
			carousel = layui.carousel,
			form = layui.form,
			util = layui.util,
			$ = layui.$;
		
		//固定块
		  util.fixbar({
		    bar1: '&#xe65c'
		    ,css: {right: 40, bottom: 30}
		    ,bgcolor: '#393D49'
		    ,click: function(type){
		      if(type === 'bar1'){
		    	  window.history.back(-1);
		      } 
		      if (type === 'top') {
	                layer.msg('返回顶部')
	          }
		    }
		  });

		//显示菜单栏用户信息
			$.ajax({
			    type: 'GET',
			    url: "login/getLoginUser",
			    success: function (data) { 
			    	if(data.type!="学生"){
			    		loginout();
			    	}
			    	$("#username").append(data.name);
			    	$("#userlogo").attr('src',data.user_logo);
			    }
			});
		//是否显示管理菜单
		$.ajax({
			    type: 'GET',
			    url: "login/president",
			    success: function (msg) { 
			        if(msg==0){
			        	$("#nav-manager").hide();
			        }
			        else{
			        	$("#nav-buildclub").hide();
			        }
			    }
			});
		//退出登录
		 loginout=function(){
			$.ajax({
 			    type: 'GET',
 			    url: "login/logout",
 			    success: function (msg) { 
 			        if(msg==1){
 			        	layer.msg('退出成功，正在跳转......', {icon: 6});
	                    setTimeout(function () {
	                        window.location.href = "stu-login";
	                    }, 2000);
 			        }
 			        else{
 			        	layer.msg('退出错误，请重试', {icon: 5});
 			        }
 			    }
 			});
		}
		//监听导航点击
		element.on('nav(demo)', function(elem) {
			//console.log(elem)
			layer.msg(elem.text());
		});

		//图片轮播
		carousel.render({
			elem: '#test',
			width: '100%',
			height: '415px',
			interval: 3000
		});
		//加载top3数据
		var top1cid;
        var top2cid;
        var top3cid;
		$.ajax({
			type: 'GET',
			url: "club/selectTop",
			async: false,
			success: function(data) {
				$.each(data, function(index, item) {
					if(index == 0) {
						top1cid=item.cid;
						$("#top1cid").text(item.cid);
						$("#top1-cname").text(item.cname);
						$("#top1-contents").text(item.club_contents);
						$("#top1-logo").attr("src", item.club_logo)
					} else if(index == 1) {
						top2cid=item.cid;
						$("#top2cid").text(item.cid);
						$("#top2-cname").text(item.cname);
						$("#top2-contents").text(item.club_contents);
						$("#top2-logo").attr("src", item.club_logo)
					} else {
						top3cid=item.cid;
						$("#top3cid").text(item.cid);
						$("#top3-cname").text(item.cname);
						$("#top3-contents").text(item.club_contents);
						$("#top3-logo").attr("src", item.club_logo)
					}
				})
			},
		});
		//显示分类按钮
	    $.ajax({
			    type: 'GET',
			    url: "clubType/list",
			    async:false,
			    success: function (data) { 
			    	$.each(data, function(index, item){
			    		var btnstr=$("<span></span>").text(item.club_type_name);
			    		var btn=$("<label><input type='radio' name='test' value='"+item.ctid+"'/></label>").append(btnstr);
			    		$("#btns-type").append(btn);
			    	})
			    }
			});
		//分页显示社团
		var count = 0;

		function showReocrd(pageNo, pageSize) {
			$.ajax({
				type: 'GET',
				url: "club/selectRun?page=" + pageNo + "&limit=" + pageSize+"&ctid="+$('input[type=radio][name=test]:checked').val(),
				async: false,
				success: function(datas) {
					count = datas.count;
					$.each(datas.data, function(index, item) {
						var cname = $("<div style='font-size: 18px;color:#1E9FFF;font-weight:550;'></div>").text(item.cname);
						var logo=$("<img style='width:50px;border-radius:50%;'></img>").attr('src',item.club_logo);
						var t1 = $("<div class='layui-col-md3'></div>").append(logo);
						var t2 = $(" <div class='layui-col-md9' style='padding-top:15px;'></div>").append(cname);
						var t = $("<div class='layui-row'></div>").append(t1,t2);
						var contents = $("<div style='font-size: 14px;'></div>").text(item.club_contents);
						var t3 = $("<div class='layui-card-body' style='height:110px;overflow: hidden;display:-webkit-box; -webkit-line-clamp:2;-webkit-box-orient: vertical;'></div>").append(t,contents);
						var btn1=$("<div class='layui-col-xs6' style='padding-left:20px;padding-right:5px;'><button type='button' onclick='join("+item.cid+")' class='layui-btn layui-btn-sm layui-btn-green layui-btn-radius layui-btn-fluid'><i class='layui-icon layui-icon-add-circle'></i>申请加入</button></div>");
						var btn2=$("<div class='layui-col-xs6' style='padding-left:5px;padding-right:20px;'><button type='button' onclick='more("+item.cid+")' class='layui-btn layui-btn-sm layui-btn-normal layui-btn-radius layui-btn-fluid'><i class='layui-icon layui-icon-more'></i>查看详情</button></div>");
						var t4 = $("<div class='layui-row'></div>").append(btn1,btn2);
						var t5 = $("<div class='layui-card small' style='padding-bottom:10px;background-color: #F2F2F2;border-radius:25px;'></div>").append(t3, t4);
						var t6 = $("<div style='padding: 10px;'></div>").append(t5);
						var t7 = $("<div class='layui-col-sm3'></div>").append(t6);
						$("#club-list").append(t7);
					})
				},
			});
		}
		showReocrd(1, 8); //先展示第一页，每页8条数据
		laypage.render({
			elem: 'demo',
			count: count,
			theme: '#1E9FFF',
			limit: 8 //设置每页条数                
				,
			curr: 1 //起始页
				,
			jump: function(obj, first) { //obj为当前页的属性和方法，第一次加载first为true
				if(!first) {
					//清空以前加载的数据
					$('#club-list').empty();
					//调用加载函数加载数据
					showReocrd(obj.curr, obj.limit);
				}
			}
		});
		
		//切换类别
		$('input[type=radio][name=test]').change(function() {
			    $('#club-list').empty();
				showReocrd(1, 8); 
				laypage.render({
					elem: 'demo',
					count: count,
					theme: '#1E9FFF',
					limit: 8 //设置每页条数                
						,
					curr: 1 //起始页
						,
					jump: function(obj, first) { //obj为当前页的属性和方法，第一次加载first为true
						if(!first) {
							//清空以前加载的数据
							$('#club-list').empty();
							//调用加载函数加载数据
							showReocrd(obj.curr, obj.limit);
						}
					}
				});
	    });
		
		join=function(cid){
			layer.prompt({
				formType: 2,
				value: '请认真填写入社理由...',
				title: '入社理由',
				btn:['提交申请','再想想'],
				maxlength: 50,
				area: ['300px', '150px'] //自定义文本域宽高
			}, function(value, index, elem) {
				var str={cid:cid,uid:-1,reason:value};
				$.ajax({
		              type: 'POST',
		              url: "club/addmemberStu",
		              dataType: 'json',
		              contentType: 'application/json',
		              data: JSON.stringify(str),
		              success: function (msg) { 
		                  if (msg == 1) {
		                	  layer.msg("申请成功！请等待审核结果")
		                  } 
		                  else if(msg == -1){
		                      layer.msg('您已是该社团成员');
		                  }
		                  else {
		                      layer.msg('操作失败！请重试');
		                  }
		              },
		          });
				layer.close(index);
			}, function(){
				  
			});
		}
		
		more=function(cid){
 			window.location.href = "club-more?cid="+cid;
		}
		
		$(document).on('click',"#joinNow1",function(){
			layer.prompt({
				formType: 2,
				value: '请认真填写入社理由...',
				title: '入社理由',
				btn:['提交申请','再想想'],
				maxlength: 50,
				area: ['300px', '150px'] //自定义文本域宽高
			}, function(value, index, elem) {
				var str={cid:top1cid,uid:-1,reason:value};
				$.ajax({
		              type: 'POST',
		              url: "club/addmemberStu",
		              dataType: 'json',
		              contentType: 'application/json',
		              data: JSON.stringify(str),
		              success: function (msg) { 
		                  if (msg == 1) {
		                	  layer.msg("申请成功！请等待审核结果")
		                  } 
		                  else if(msg == -1){
		                      layer.msg('您已是该社团成员');
		                  }
		                  else {
		                      layer.msg('操作失败！请重试');
		                  }
		              },
		          });
				layer.close(index);
			}, function(){
				  
			});
	    });
		
		$(document).on('click',"#joinNow2",function(){
			layer.prompt({
				formType: 2,
				value: '请认真填写入社理由...',
				title: '入社理由',
				btn:['提交申请','再想想'],
				maxlength: 50,
				area: ['300px', '150px'] //自定义文本域宽高
			}, function(value, index, elem) {
				var str={cid:top2cid,uid:-1,reason:value};
				$.ajax({
		              type: 'POST',
		              url: "club/addmemberStu",
		              dataType: 'json',
		              contentType: 'application/json',
		              data: JSON.stringify(str),
		              success: function (msg) { 
		                  if (msg == 1) {
		                	  layer.msg("申请成功！请等待审核结果")
		                  } 
		                  else if(msg == -1){
		                      layer.msg('您已是该社团成员');
		                  }
		                  else {
		                      layer.msg('操作失败！请重试');
		                  }
		              },
		          });
				layer.close(index);
			}, function(){
				  
			});
	    });
		
		$(document).on('click',"#joinNow3",function(){
			layer.prompt({
				formType: 2,
				value: '请认真填写入社理由...',
				title: '入社理由',
				btn:['提交申请','再想想'],
				maxlength: 50,
				area: ['300px', '150px'] //自定义文本域宽高
			}, function(value, index, elem) {
				var str={cid:top3cid,uid:-1,reason:value};
				$.ajax({
		              type: 'POST',
		              url: "club/addmemberStu",
		              dataType: 'json',
		              contentType: 'application/json',
		              data: JSON.stringify(str),
		              success: function (msg) { 
		                  if (msg == 1) {
		                	  layer.msg("申请成功！请等待审核结果")
		                  } 
		                  else if(msg == -1){
		                      layer.msg('您已是该社团成员');
		                  }
		                  else {
		                      layer.msg('操作失败！请重试');
		                  }
		              },
		          });
				layer.close(index);
			}, function(){
				  
			});
	    });

	});
</script>