<link rel="stylesheet" href="vendor/layui/css/layui.css">
<script type="text/javascript" src="vendor/layui/layui.js"></script>
<script type="text/javascript" src="vendor/jquery/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.params.js"></script>
<link rel="stylesheet" href="vendor/layui/css/stu-index.css">
<body style="background: transparent url(img/PTS_Movie_Branding_Background.jpg)no-repeat 0 0;background-attachment: fixed;background-size: cover;">
<div class="layui-layout layui-layout-admin">
	<div class="layui-header" style="z-index:9999;position: relative;">

		<!-- 头部区域 -->
		<ul class="layui-nav" style="padding: 0 200px;">
			<div class="layui-logo" style="color:white;">AMS-stu</div>
			<li class="layui-nav-item">
				<a href="stu-index">首页</a>
			</li>
			<li class="layui-nav-item">
				<a href="#">社团</a>
				<dl class="layui-nav-child">
				    <dd>
						<a href="club-list">社团展示</a>
					</dd>
					<dd>
						<a href="club-build" id="nav-buildclub">创建社团</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item">
				<a href="#">活动</a>
				<dl class="layui-nav-child">
					<dd>
						<a href="activity-all-list">校内活动</a>
					</dd>
					<dd>
						<a href="activity-inner-list">社内活动</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item">
				<a href="news-all-list">新闻</a>
			</li>
			<li class="layui-nav-item">
				<a href="javascript:;">我的</a>
				<dl class="layui-nav-child">
					<dd>
						<a href="club-mine">我的社团</a>
					</dd>
					<dd>
						<a href="notice-mine">我的公告</a>
					</dd>
					<dd>
						<a href="myAct">我的活动</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item" id="nav-manager">
				<a href="javascript:;">管理</a>
				<dl class="layui-nav-child">
					<dd>
						<a href="manageClub">社团管理</a>
					</dd>
					<dd>
						<a href="manageNotice">公告管理</a>
					</dd>
					<dd>
						<a href="addNotice">发布公告</a>
					</dd>
					<dd>
						<a href="manageAct">活动管理</a>
					</dd>
					<dd>
						<a href="applyAct">申请活动</a>
					</dd>
		            <dd>
						<a href="managenews">新闻管理</a>
					</dd>
					<dd>
						<a href="addnews">发布新闻</a>
					</dd>
				</dl>
			 </li>
		</ul>

		<ul class="layui-nav layui-layout-right">
			<li class="layui-nav-item layui-hide-xs" lay-unselect>
				<input type="text" placeholder="搜索..." autocomplete="off" class="layui-input layui-input-search" layadmin-event="serach" lay-action="template/search/keywords=">
			</li>
			<li class="layui-nav-item">
				<a href="javascript:;" id='username'>
					<img id="userlogo" class="layui-nav-img">
				</a>
				<dl class="layui-nav-child">
					<dd>
						<a href="userinformation">基本资料</a>
					</dd>
					<dd>
						<a href="setPwd">修改密码</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item">
				<a href="javascript:void(0);" onclick="loginout()">退出登录</a>
			</li>
		</ul>

	</div>

	<!-- 主体内容 -->
	<div class="layui-body" style="margin-top:30px;">
		<div style="margin-right:200px;background-color:white;padding:1px 20px 15px 20px;border-radius:25px;">

			<fieldset class="layui-elem-field" style="margin-top: 20px;border-radius:25px;padding:0 20px 0 20px;border-width:2px;">
				<legend id="cname" style="font-size:22px;font-weight:500;color:#666666;">社团名称</legend>
				<div class="layui-field-box">
					<div class="layui-fluid">
						<div class="d1" style="background:#eeeeee;padding-top:20px;padding-bottom:20px;margin:20px 50px 10px 50px;border-radius:25px;">
							<div class="layui-row" style="text-align:center;">
								<div class="layui-col-xs6">
									<div class="layui-row grid-demo">
										<div class="layui-col-md3" style="writing-mode:vertical-lr;margin-top:15px;font-size:22px;letter-spacing:10px;padding-left:40px;">
											社团信息
										</div>
										<div class="layui-col-md9">
                                             <img id="logo" style="width: 150px;border-radius: 50%;"></img>
                                        </div>
										</div>
								</div>
								<div class="layui-col-xs6">
								    <span id="clubnum" class="layui-badge" style="width:40px;height:18px;font-size:14px;margin-right:15px;">社团人数</span>
								    <button id="club_type" class="layui-btn layui-btn-warm layui-btn-radius" style="text-align:right;margin-right:-220px;"></button>			    
									<div id="contents" style="text-align:left;font-size:18px;color:grey;margin-top:25px;">
										社团介绍
									</div>
								</div>
							</div>

						</div>
					</div>

					<div class="layui-fluid">
						<div class="d1" style="background:#eeeeee;padding-top:20px;padding-bottom:20px;margin:30px 50px 10px 50px;border-radius:25px;">
							<div class="layui-row" style="text-align:center;">
								<div class="layui-col-xs6">
									<div class="layui-row grid-demo">
										<div class="layui-col-md3" style="writing-mode:vertical-lr;margin-top:15px;font-size:22px;letter-spacing:10px;padding-left:40px;">
											社长信息
										</div>
										<div class="layui-col-md9">
											<img id="user_logo" style="width: 150px;border-radius: 50%;"></img>
										</div>
									</div>
								</div>
								<div class="layui-col-xs6">

									<div class="layui-row" style="padding-top:5px;padding-bottom:10px;">
										<div class="layui-col-md1">
											<i class="layui-icon layui-icon-user"></i>
										</div>
										<div id="chargename" class="layui-col-md8" style="font-size:17px;color:grey;margin-top:-1px;">姓名</div>
									</div>

									<div class="layui-row" style="padding-top:10px;padding-bottom:10px;">
										<div class="layui-col-md1">
											<i class="layui-icon layui-icon-template-1"></i>
										</div>
										<div id="banji" class="layui-col-md8" style="font-size:17px;color:grey;margin-top:-2px;">
											班级
										</div>
									</div>

									<div class="layui-row" style="padding-top:10px;padding-bottom:10px;">
										<div class="layui-col-md1">
											<i class="layui-icon layui-icon-cellphone-fine"></i>
										</div>
										<div id="phone" class="layui-col-md8" style="font-size:17px;color:grey;">
											手机号
										</div>
									</div>

									<div class="layui-row" style="padding-top:10px;">
										<div class="layui-col-md1">
											<i class="layui-icon layui-icon-release"></i>
										</div>
										<div id="email" class="layui-col-md8" style="font-size:17px;color:grey;margin-top:-3px;">
											邮箱
										</div>
									</div>

								</div>
							</div>

						</div>
					</div>
					
					<div class="join" style="margin:20px 67px 20px 67px;">
					    <button type="button" id="join" class="layui-btn layui-btn-radius layui-btn-normal layui-btn-fluid" style="margin-top:10px;">申 请 加 入</button>
                    </div>
				</div>

		</fieldset>
	</div>
</div>

</div>
</body>
<script>
var clubnum; //定义社团人数
	var cid = $.query.get("cid");
	$.ajax({
		type: 'GET',
		url: "club/selectOne?cid=" + cid,
		success: function(data) {
			$("#cname").text(data.cname);
			$("#logo").attr("src", data.club_logo);
			$("#club_type").text(data.club_type_name);
			$("#contents").text(data.club_contents);
		},
	});
	$.ajax({
		type: 'GET',
		url: "club/listPresident?cid=" + cid,
		success: function(data) {
			$("#user_logo").attr("src", data.user_logo);
			$("#chargename").text(data.name);
			$("#banji").text(data.major + data.class_num);
			if(data.phone == null || data.phone == '') {
				$("#phone").text("TA还没有留下手机号～");
			} else {
				$("#phone").text(data.phone);
			}
			if(data.email == null || data.email == '') {
				$("#email").text("TA还没有留下邮箱～");
			} else {
				$("#email").text(data.email);
			}
		},
	});
	
	//获取社团人数
	$.ajax({
	    type: 'GET',
	    async:false,
	    url: "club/countMember?cid="+cid,
	    success: function (count) { 
	        $("#clubnum").text(count+"人");
	        clubnum=count;
	    },
	});

	layui.use(['laypage', 'layer', 'element', 'carousel', 'form', 'util'], function() {
		var laypage = layui.laypage,
			layer = layui.layer,
			element = layui.element,
			carousel = layui.carousel,
			form = layui.form,
			util = layui.util,
			$ = layui.$;
		
		//滚动时保存滚动位置
		$(window).scroll(function(){
		  if($(document).scrollTop()!=0){
		    sessionStorage.setItem("offsetTop", $(window).scrollTop());
		  }
		});
		//onload时，取出并滚动到上次保存位置
		window.onload = function(){
		  var offset = sessionStorage.getItem("offsetTop");
		  $(document).scrollTop(offset);
		};
		
		//固定块
		  util.fixbar({
		    bar1: '&#xe65c'
		    ,css: {right: 30, bottom: 30}
		    ,bgcolor: '#393D49'
		    ,click: function(type){
		      if(type === 'bar1'){
		    	  window.history.back(-1);
		      } 
		      if (type === 'top') {
	                layer.msg('返回顶部')
	          }
		    }
		  });
		
		//显示菜单栏用户信息
			$.ajax({
			    type: 'GET',
			    url: "login/getLoginUser",
			    success: function (data) { 
			    	if(data.type!="学生"){
			    		loginout();
			    	}
			    	$("#username").append(data.name);
			    	$("#userlogo").attr('src',data.user_logo);
			    }
			});
		//是否显示管理菜单
		$.ajax({
			    type: 'GET',
			    url: "login/president",
			    success: function (msg) { 
			        if(msg==0){
			        	$("#nav-manager").hide();
			        }
			        else{
			        	$("#nav-buildclub").hide();
			        }
			    }
			});
		//退出登录
		 loginout=function(){
			$.ajax({
 			    type: 'GET',
 			    url: "login/logout",
 			    success: function (msg) { 
 			        if(msg==1){
 			        	layer.msg('退出成功，正在跳转......', {icon: 6});
	                    setTimeout(function () {
	                        window.location.href = "stu-login";
	                    }, 2000);
 			        }
 			        else{
 			        	layer.msg('退出错误，请重试', {icon: 5});
 			        }
 			    }
 			});
		}
		//监听导航点击
		element.on('nav(demo)', function(elem) {
			//console.log(elem)
			layer.msg(elem.text());
		});
		
		$(document).on('click',"#join",function(){
			layer.prompt({
				formType: 2,
				value: '请认真填写入社理由...',
				title: '入社理由',
				btn:['提交申请','再想想'],
				maxlength: 50,
				area: ['300px', '150px'] //自定义文本域宽高
			}, function(value, index, elem) {
				var str={cid:cid,uid:-1,reason:value};
				$.ajax({
		              type: 'POST',
		              url: "club/addmemberStu",
		              dataType: 'json',
		              contentType: 'application/json',
		              data: JSON.stringify(str),
		              success: function (msg) { 
		                  if (msg == 1) {
		                	  layer.msg("申请成功！请等待审核结果")
		                  } 
		                  else if(msg == -1){
		                      layer.msg('您已是该社团成员');
		                  }
		                  else {
		                      layer.msg('操作失败！请重试');
		                  }
		              },
		          });
				layer.close(index);
			}, function(){
				  
			});
	    });

	});
</script>